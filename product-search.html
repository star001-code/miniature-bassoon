<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>📦 الحاسبة الذكية للرسم كمرك العراق</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:"Segoe UI","Noto Naskh Arabic",sans-serif;background:#0f172a;color:#e5e7eb;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0}
  .card{background:#111827;padding:20px;border-radius:14px;max-width:480px;width:100%;box-shadow:0 4px 10px rgba(0,0,0,0.4)}
  h1{text-align:center;color:#60a5fa;margin-top:0}
  label{display:block;margin:10px 0 4px}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#e5e7eb}
  button{width:100%;padding:12px;margin-top:12px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer;font-size:16px}
  button:hover{background:#3b82f6}
  .result{margin-top:12px;padding:12px;border-radius:10px;background:#0b1220}
  .ok{background:#064e3b;color:#d1fae5}
</style>
</head>
<body>
<div class="card">
  <h1>📦 الحاسبة الذكية<br>للرسم كمرك العراق</h1>

  <label>🔎 ابحث بالاسم أو IDE</label>
  <input id="q" placeholder="مثال: عجول / 1022910">

  <label>⚖️ الوزن الكلي (كغ)</label>
  <input id="w" type="number">

  <label>💵 الرسم المدفوع بإبراهيم خليل (USD)</label>
  <input id="paid" type="number">

  <label>💰 القيمة الكلية للحمل (USD)</label>
  <input id="total" type="number">

  <label>📊 قيمة الإيراد (GDS_YER)</label>
  <input id="yer" type="number">

  <label>🔢 سعر الصرف (دينار/دولار)</label>
  <input id="ex" type="number" value="1320">

  <label>🏷️ النسبة (%)</label>
  <input id="rt" type="number" value="6" step="0.01">

  <button onclick="calc()">احسب</button>
  <div id="out" class="result ok" style="display:none"></div>
</div>

<script>
let DB=[], current=null;
const $=s=>document.querySelector(s);
const fmt=x=>{const n=Number(x);return isFinite(n)?n.toLocaleString('ar-IQ',{maximumFractionDigits:3}):'-';};

function calc(){
  const w    = parseFloat($("#w").value)||0;
  const paid = parseFloat($("#paid").value)||0;
  const yer  = parseFloat($("#yer").value)||0;
  const ex   = parseFloat($("#ex").value)||1320;
  const rt   = parseFloat($("#rt").value)||6;

  if(!(w>0) || !(yer>0)){
    alert("⚠️ أدخل الوزن وقيمة الإيراد (GDS_YER)");
    return;
  }

  // المعادلة حسب الوصف:
  // الرسم = (وزن × GDS_YER × (النسبة ÷ 100)) + (الرسم المدفوع) × سعر الصرف
  const A  = w * yer * (rt/100);
  const B  = paid;
  const AB = (A + B) * ex;   // النتيجة النهائية بالدينار

  const out=$("#out"); out.style.display="";
  out.innerHTML=`
    <div>🏷️ المنتج: ${current?current.product:($("#q").value||"-")}</div>
    <div>🔢 رقم التسريحة (IDE): ${current?(current.IDE||"-"):"-"}</div>
    <div>⚖️ الوزن الكلي: ${fmt(w)} كغ</div>
    <div>💰 قيمة الإيراد (GDS_YER): ${fmt(yer)} USD/طن</div>
    <div>🏷️ النسبة: ${rt}%</div>
    <div>💵 الرسم المدفوع بإبراهيم خليل: ${fmt(B)} USD</div>
    <div><b>✅💳 الرسم النهائي: ${fmt(AB)} دينار</b></div>
  `;
}

// تحميل المنتجات (اختياري إذا عندك products.json)
(async()=>{
  try{
    const res=await fetch("products.json");
    DB=await res.json();
  }catch(e){}
  const p=new URLSearchParams(location.search);
  const q=p.get("name")||p.get("ide");
  if(q){
    $("#q").value=q;
    current=DB.find(r=>r.product==q || r.IDE==q) || null;
    if(current && current.GDS_YER) $("#yer").value=current.GDS_YER;
  }
})();
</script>
</body>
</html>
