<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>ğŸ” Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø±Ø³Ù… Ø§Ù„ÙƒÙ…Ø±ÙƒÙŠ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:"Segoe UI","Noto Naskh Arabic",sans-serif;background:#0f172a;color:#e5e7eb;margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh}
  .card{background:#111827;padding:20px;border-radius:14px;max-width:460px;width:100%;box-shadow:0 4px 10px rgba(0,0,0,0.4)}
  h1{text-align:center;color:#60a5fa;margin-top:0}
  label{display:block;margin:10px 0 4px}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#e5e7eb}
  button{width:100%;padding:12px;margin-top:12px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer;font-size:16px}
  button:hover{background:#3b82f6}
  .result{margin-top:12px;padding:12px;border-radius:10px;background:#0b1220}
  .kv{display:grid;grid-template-columns:1fr auto;gap:8px;padding:6px 0;border-bottom:1px solid #1f2937}
  .ok{background:#064e3b;color:#d1fae5}
  .warn{color:#fca5a5;font-size:12px;margin-top:8px}
</style>
</head>
<body>
<div class="card">
  <h1>ğŸ“¦ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>

  <div id="pre" class="result" style="display:none"></div>

  <label>ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ IDE</label>
  <input id="q" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¬ÙˆÙ„ / 1022910">

  <label>âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙƒÙ„ÙŠ (ÙƒØº)</label>
  <input id="w" type="number" placeholder="Ù…Ø«Ø§Ù„: 5000">

  <label>ğŸ’µ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø¨Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ù„ÙŠÙ„ (USD)</label>
  <input id="paid" type="number" placeholder="Ù…Ø«Ø§Ù„: 1200">

  <label>ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ (GDS_YER) â€” Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù† Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label>
  <input id="yer" type="number" placeholder="Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ùˆ ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ùˆ Ø§Ø®ØªØ±Øª Ù…Ù†ØªØ¬">

  <label>ğŸ”¢ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù (Ø¯ÙŠÙ†Ø§Ø±/Ø¯ÙˆÙ„Ø§Ø±)</label>
  <input id="ex" type="number" value="1320">

  <label>ğŸ·ï¸ Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
  <input id="rt" type="number" value="6" step="0.01">

  <button id="calcBtn">Ø§Ø­Ø³Ø¨</button>

  <div id="out" class="result ok" style="display:none"></div>
  <div id="msg" class="warn"></div>
</div>

<script>
let DB=[], current=null;
const $=s=>document.querySelector(s);
const fmt=x=>{const n=Number(x);return isFinite(n)?n.toLocaleString('ar-IQ',{maximumFractionDigits:3}):'-';};
function prep(a){
  return a.map(r=>({
    product: r.product||r.GDS_DS2,
    IDE: (r.IDE_HSC_NB1||r.IDE)||null,
    GDS_MIN: +r.GDS_MIN,
    GDS_MAX: +r.GDS_MAX,
    GDS_YER: r.GDS_YER ? +r.GDS_YER : (+r.GDS_MIN + +r.GDS_MAX)/2
  })).filter(r=>r.product);
}
function findOne(q){
  q=(q||'').toString().trim().toLowerCase();
  return DB.find(r=> r.product.toLowerCase().includes(q) || ((r.IDE||'').toLowerCase().includes(q)) ) || null;
}

function showPre(rec){
  $("#pre").style.display="";
  $("#pre").innerHTML = `
    <div class="kv"><div>ğŸ·ï¸ Ø§Ù„Ù…Ù†ØªØ¬</div><div><b>${rec.product}</b></div></div>
    <div class="kv"><div>IDE</div><div>${rec.IDE||"-"}</div></div>
    <div class="kv"><div>GDS_MIN</div><div>${fmt(rec.GDS_MIN)}</div></div>
    <div class="kv"><div>GDS_MAX</div><div>${fmt(rec.GDS_MAX)}</div></div>
    <div class="kv"><div>ğŸ’° GDS_YER (Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù† Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±)</div><div><b>${fmt(rec.GDS_YER)}</b></div></div>
  `;
  // Ù†Ù…Ù„Ø£ GDS_YER ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
  $("#yer").value = rec.GDS_YER || "";
  current = rec;
}

function calc(){
  const w   = parseFloat($("#w").value);
  const paid= parseFloat($("#paid").value)||0;
  const yer = parseFloat($("#yer").value);
  const ex  = parseFloat($("#ex").value);
  const rt  = parseFloat($("#rt").value);

  if(!(w>0) || !(yer>0) || !(ex>0)){
    $("#msg").textContent="âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ùˆ GDS_YER ÙˆØ³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.";
    return;
  }
  $("#msg").textContent="";

  // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
  // A = ÙˆØ²Ù† Ã— Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª(GDS_YER) Ã— (Ø§Ù„Ù†Ø³Ø¨Ø© Ã· 100)
  // B = Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙÙŠ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ù„ÙŠÙ„ (USD)
  // AB = A - B
  // Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ = AB Ã— Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù
  const A  = w * yer * (rt/100);
  const B  = paid;
  const AB = A - B;
  const finalIQD = AB * ex;

  $("#out").style.display="";
  $("#out").innerHTML = `
    <div class="kv"><div>ğŸ·ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</div><div>${current?current.product:($("#q").value||"-")}</div></div>
    <div class="kv"><div>ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø±ÙŠØ­Ø© (IDE)</div><div>${current?(current.IDE||"-"):"-"}</div></div>
    <div class="kv"><div>âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙƒÙ„ÙŠ (ÙƒØº)</div><div>${fmt(w)}</div></div>
    <div class="kv"><div>ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù† (GDS_YER)</div><div>${fmt(yer)} USD</div></div>
    <div class="kv"><div>ğŸ·ï¸ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div><div>${rt}%</div></div>
    <div class="kv"><div>ğŸ’µ B: Ø±Ø³Ù… Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ù„ÙŠÙ„</div><div>${fmt(B)} USD</div></div>
    <div class="kv"><div>ğŸ§® A = ÙˆØ²Ù† Ã— GDS_YER Ã— Ø§Ù„Ù†Ø³Ø¨Ø©</div><div>${fmt(A)} USD</div></div>
    <div class="kv"><div>â– AB = A - B</div><div>${fmt(AB)} USD</div></div>
    <div class="kv"><div>âœ… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¯ÙŠÙ†Ø§Ø±)</div><div><b>${fmt(finalIQD)}</b> IQD</div></div>
  `;
}

async function boot(){
  try{
    const res=await fetch('products.json',{cache:'no-store'});
    if(res.ok){ DB=prep(await res.json()); }
  }catch(e){}

  // Ø§Ù„ØªÙ‚Ø§Ø· ?name Ø£Ùˆ ?ide Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
  const p=new URLSearchParams(location.search);
  const q=p.get('name')||p.get('ide');
  if(q){
    $("#q").value = q;
    const rec = findOne(q);
    if(rec) showPre(rec);
  }

  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…/IDEØŒ Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
  $("#q").addEventListener('change', ()=>{
    const rec = findOne($("#q").value);
    if(rec) showPre(rec);
  });
  $("#calcBtn").addEventListener('click', calc);
}
boot();
</script>
</body>
</html>
