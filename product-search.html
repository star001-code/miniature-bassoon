<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>🔎 الحاسبة الذكية للرسم الكمركي</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<h1>🔎 الحاسبة الذكية</h1>

<label>ابحث بالاسم أو IDE</label>
<input id="q">

<label>⚖️ الوزن الكلي (كغ)</label>
<input id="w" type="number">

<label>💵 الرسم المدفوع بإبراهيم خليل (USD)</label>
<input id="paid" type="number">

<label>💰 قيمة الإيراد (GDS_YER)</label>
<input id="yer" type="number">

<label>🔢 سعر الصرف (دينار/دولار)</label>
<input id="ex" type="number" value="1320">

<label>🏷️ النسبة (%)</label>
<input id="rt" type="number" value="6">

<button onclick="calc()">احسب</button>
<div id="out"></div>

<script>
let DB=[], current=null;
const $=s=>document.querySelector(s);

function findOne(q){
  q=q.toLowerCase();
  return DB.find(r=>r.product.toLowerCase().includes(q)||(r.IDE||"").toLowerCase().includes(q));
}

function calc(){
  const w=+$("#w").value;
  const paid=+$("#paid").value;
  const yer=+$("#yer").value;
  const ex=+$("#ex").value;
  const rt=+$("#rt").value;

  const A = w * yer * (rt/100);
  const B = paid;
  const AB = A - B;
  const finalIQD = AB * ex;

  $("#out").innerHTML=`
    <p>🏷️ المنتج: ${current?current.product:$("#q").value}</p>
    <p>IDE: ${current?current.IDE:"-"}</p>
    <p>A = ${A.toFixed(2)} USD</p>
    <p>B = ${B.toFixed(2)} USD</p>
    <p>AB = ${AB.toFixed(2)} USD</p>
    <p><b>✅ الرسم النهائي: ${finalIQD.toFixed(2)} دينار</b></p>`;
}

(async()=>{
  try{
    const res=await fetch("products.json");
    DB=await res.json();
  }catch{}
  const p=new URLSearchParams(location.search);
  const q=p.get("name")||p.get("ide");
  if(q){$("#q").value=q; current=findOne(q); if(current){$("#yer").value=current.GDS_YER;}}
})();
</script>
</body>
</html>
